trigger:
  batch: true
  branches:
    include:
      - master
  paths:
    include:
      - "Linux/Build/Image"
    exclude:
      - "*"

pr:
  paths:
    include:
      - "Linux/Build/Image"

resources:
  repositories:
  - repository: das-platform-building-blocks
    type: github
    name: SkillsFundingAgency/das-platform-building-blocks
    ref: refs/tags/0.4.63
    endpoint: SFA

schedules:
- cron: "0 6 * * Tue"
  displayName: Weekly Tuesday morning build
  branches:
    include:
    - master
  always: true

pool:
  vmImage: ubuntu-latest

variables:
- group : Release Management Resources

steps:
- template: azure-pipelines-templates/build/step/gitversion.yml@das-platform-building-blocks
- template: azure-pipelines-templates/build/step/dockerfile-build.yml@das-platform-building-blocks
  parameters:
    ContainerRegistryName: $(PublicAcrName)
    ServiceConnection: SFA-DIG-Prod-ARM
    ImageName: azure-pipelines-build-agent-ubuntu-20
    WorkingDirectory: Linux/Build/Image
    BranchToCreateLatestTag: master
