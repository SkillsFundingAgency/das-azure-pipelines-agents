trigger:
  batch: true
  branches:
    include:
      - "*"
  paths:
    include:
      - "Linux/Ubuntu-18/Build/*"
    exclude:
      - "*"

pr: none

resources:
  repositories:
  - repository: das-platform-building-blocks
    type: github
    name: SkillsFundingAgency/das-platform-building-blocks
    ref: DASD-8851-add-tokenize-template
    endpoint: SFA

pool:
  name: DAS - Continuous Integration
  demands: Agent.OS -equals Windows_NT

variables:
- group : Release Management Resources

steps:
  - template: azure-pipelines-templates/deploy/step/tokenize-files.yml@das-platform-building-blocks
    parameters:
      TargetFiles: Dockerfile

  - template: azure-pipelines-templates/build/step/dockerfile-build.yml@das-platform-building-blocks
    parameters:
      ContainerRegistryName: $(PublicAcrName)
      ServiceConnection: SFA-DIG-Prod-ARM
      ImageName: azure-pipelines-build-agent-ubuntu-18
      WorkingDirectory: Linux/Ubuntu-18/Build
      BranchToCreateLatestTag: DASD-8851-ubuntu-18-20-build-agents.2

  - task: CopyFiles@2
    displayName: "Copy Files to: $(build.artifactstagingdirectory)"
    inputs:
      Contents: |
        Linux/Ubuntu-18/Build/manifest.yml
      TargetFolder: "$(build.artifactstagingdirectory)/publish"
      OverWrite: true

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact"
    inputs:
      PathtoPublish: "$(build.artifactstagingdirectory)/publish"

